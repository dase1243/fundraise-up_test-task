## Тестовое задание Fundraise Up

### Задача анонимизации данных пользователей

## Packages

### dependencies

- ```mongodb```
- ```dotenv```
- ```@faker-js/faker```

### dev dependencies

- ```prettier```
- ```ts-node```
- ```typescript```

## Подготовка

Чтобы начать работать с проектом, необходимо установить все зависимости

```bash
npm install
```

Также необходимо создать ```.env``` файл, где будет находиться переменная ```DB_URI```. \
Как пример ```.env``` можно посмотреть ```.env.example```

## Работа с проектом

У проекта есть несколько режимов работы.

### 1. Генерация фейковых пользователей и сохранение их

```bash
npm run start
```

После этого, сгенерированные пользователи будут добавляться в базу данных

### 2. Анонимизирование пользователей

В этом режиме синхронизируются ново-добавленные пользователи. Также, синхронизируются пользователи, которые были
добавлены пока скрипт был выключен.

```bash
npm run sync
```

Синхронизация происходит с помощью watcher, которые слушает ```update``` и ```insert``` события на
коллекции ```customers```.
Чтобы алгоритм понимал, какие документы были уже анонимизированы, существует дополнительная
коллекция ```customers_anonymization_state```.
В ней хранится одно значение - время создания последнего анонимизированного пользователя.

После этого, сгенерированные пользователи будут добавляться в базу данных

### 3. Полная ре-анонимизация пользователей

В этом режиме скрипт анонимизации запускает по всем существующим записям в ```customers```. В этом случае удаляются все
документы из коллекции ```customers_anonymised```, при этом запоминается время когда этот мод был запущен. Таким
образом, если параллельно запущен скрипт синхронизации в обычном режиме, то он продолжит работать без проблем.

```bash
npm run reindex-sync
```

